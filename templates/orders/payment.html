{% extends "main/home.html" %}
{% load static %}

{% block title %}<title>Payment</title>{% endblock %}

{% block style %}
<link rel="stylesheet" href="{% static 'orders/payment.css' %}">
{% endblock style %}

{% block content %}
<div class="payment-box">

    <!-- STEPS -->
    <div class="steps">
        <div class="step active" id="step1">1<br><small>Pay</small></div>
        <div class="step" id="step2">2<br><small>Processing</small></div>
        <div class="step" id="step3">3<br><small>Done</small></div>
    </div>
    <div class="container_order_detail">
        <div>
            <strong>Order ID</strong>
            <span>#{{ order.id }}</span>
        </div>
        <div style="border-bottom: none;">
            <strong>Total Amount</strong>
            <span>₹{{ order.total_amount }}</span>
        </div>
    </div>

    <div class="checkout-container">
        <div class="payment-form">
            <div id='form_cont'>
                <h2>Payment Details</h2>
                <div class="input-group">
                    <label for="name">Cardholder Name</label>
                    <input type="text" class="pay-input" value="vimal" placeholder="John Doe" required>
                </div>

                <div class="input-group">
                    <label for="card">Card Number</label>
                    <input type="text" class="pay-input" value="1234 5678 9101 1121" placeholder="1234 5678 9101 1121" required>
                </div>

                <div class="inline-inputs">
                    <div class="input-group">
                        <label for="expiry">Expiry Date</label>
                        <input type="text" class="pay-input" value="09/25" placeholder="MM/YY" required>
                    </div>
                    <div class="input-group">
                        <label for="cvv">CVV</label>
                        <input type="password" class="pay-input" value="787" placeholder="123" required>
                    </div>
                </div>
  
                <button type="button" id="payBtn">
                    Pay Now
                </button>
            </div>
            <div id="processing" class="hidden">
                <p>Connecting to bank...</p>
                <div class="loader"></div>
            </div>
        </div>
    </div>

</div>

{% endblock %}
{% block script %}

<script>
function goToMenu() {
    window.location.href = "/";
}

function activateStep(stepNo) {
    document.querySelectorAll(".step").forEach(s => s.classList.remove("active"));
    document.getElementById("step" + stepNo).classList.add("active");
}
const btn = document.getElementById("payBtn");

btn.addEventListener("click", (e) => {
    e.preventDefault();

    const inputs = document.querySelectorAll(".pay-input");
    let isInputEmpty = false;

    inputs.forEach(input => {
        if (input.value.trim() === "") {
            isInputEmpty = true;
        }
    });

    if (isInputEmpty) {
        alert("Please fill the form");
        return;
    }

    document.getElementById("form_cont").style.display = "none";
    startPayment();
});


function startPayment() {
    activateStep(2);
    document.getElementById("payBtn").style.display = "none";
    document.getElementById("processing").classList.remove("hidden");

    setTimeout(() => {
        activateStep(3);

        fetch("/payment/success/{{ order.id }}/")
            .then(res => res.json())
            .then(() => {
                // ⏳ wait 2 sec, then go to confirmation page
                setTimeout(() => {
                    window.location.href = "/order-confirmed/{{ order.id }}/";
                }, 2000);
            });

    }, 3000);
}
</script>



{% endblock script %}